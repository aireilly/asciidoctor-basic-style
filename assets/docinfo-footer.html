<!-- Nav bar -->
<script type="text/javascript">
const navbar = document.querySelector('.navbar');

let currentPosition = window.scrollY;

// Show navbar on page load
window.addEventListener("load", (event) => {
    navbar.classList.add('show');
});

// Show/hide navbar on scroll
window.addEventListener('scroll', () => {
    if (window.scrollY < currentPosition) {
        //scroll up
        navbar.classList.remove('show');
    } else {
        //scroll down
        navbar.classList.add('show');
    }
    currentPosition = window.scrollY;
});

// Hide navbar on click event
document.querySelectorAll('*')
    .forEach(element => element.addEventListener('click', event => {
        currentPosition = window.scrollY;
        navbar.classList.remove('show');
    }))
</script>

<!-- Copy code -->
<script type="text/javascript">
const copyButtonLabel = "Copy";

let blocks = document.querySelectorAll("pre");

blocks.forEach((block) => {
    // Only add button if browser supports Clipboard API
    if (navigator.clipboard) {
        let button = document.createElement("button");

        button.innerText = copyButtonLabel;
        block.appendChild(button);

        button.addEventListener("click", async () => {
            await copyCode(block, button);
        });
    }
});

async function copyCode(block, button) {
    let code = block.querySelector("code");
    let text = code.innerText;

    await navigator.clipboard.writeText(text);

    button.innerText = "Copied!";

    setTimeout(() => {
        button.innerText = copyButtonLabel;
    }, 1500);
}
</script>
<!-- Highlight Active TOC item -->
<script type="text/javascript">
/*window.addEventListener('DOMContentLoaded', () => {

    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            const id = entry.target.getAttribute('id');
            if (entry.intersectionRatio > 0) {
                document.querySelector(`#toc.toc2 ul.sectlevel1 a[href="#${id}"]`).parentElement.classList.add('active');
            } else {
                document.querySelector(`#toc.toc2 ul.sectlevel1 a[href="#${id}"]`).parentElement.classList.remove('active');
            }
        });
    });

    // Track all h1-6 elements that have an `id` applied
    document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').forEach((heading) => {
        observer.observe(heading);
    });

});*/

function ready(fn) {
  document.addEventListener('DOMContentLoaded', fn, false)
}

ready(() => {00

  const TableOfContents = {
    container: document.querySelector('#toc.toc2'),
    links: null,
    headings: null,
    intersectionOptions: {
      rootMargin: '0px',
      threshold: 1
    },
    previousSection: null,
    observer: null,

    init() {
      this.handleObserver = this.handleObserver.bind(this)

      this.setUpObserver()
      this.findLinksAndHeadings()
      this.observeSections()


      this.links.forEach(link => {
        link.addEventListener('click', this.handleLinkClick.bind(this))
      })
    },
    

    handleLinkClick(evt) {
      evt.preventDefault()
      let id = evt.target.getAttribute('href').replace('#', '')

      let section = this.headings.find(heading => {
        return heading.getAttribute('id') === id
      })

      section.setAttribute('tabindex', -1)
      section.focus()

      window.scroll({
        behavior: motionQuery.matches ? 'instant' : 'smooth',
        top: section.offsetTop - 15,
        block: 'start'
      })

      if (this.container.classList.contains('is-active')) {
        this.container.classList.remove('is-active')
      }
    },

    handleObserver(entries, observer) {
      entries.forEach(entry => {
        let href = `#${entry.target.getAttribute('id')}`,
          link = this.links.find(l => l.getAttribute('href') === href)
        

        if (entry.isIntersecting && entry.intersectionRatio >= 1) {
          link.classList.add('is-visible')
          this.previousSection = entry.target.getAttribute('id')
        } else {
          link.classList.remove('is-visible')
        }

        this.highlightFirstActive()
      })
    },

    highlightFirstActive() {
      let firstVisibleLink = this.container.querySelector('.is-visible')

      this.links.forEach(link => {
        link.classList.remove('is-active')
      })

      if (firstVisibleLink) {
        firstVisibleLink.classList.add('is-active')
      }

      if (!firstVisibleLink && this.previousSection) {
        this.container.querySelector(
          `a[href="#${this.previousSection}"]`
        ).classList.add('is-active')
      }
    },

    observeSections() {
      this.headings.forEach(heading => {
        this.observer.observe(heading)
      })
    },

    setUpObserver() {
      this.observer = new IntersectionObserver(
        this.handleObserver,
        this.intersectionOptions
      )
    },

    findLinksAndHeadings() {
      this.links = [...this.container.querySelectorAll('a')]
      this.headings = this.links.map(link => {
        let id = link.getAttribute('href')
        return document.querySelector(id)
      })
    }
  }

  TableOfContents.init()
});

</script>